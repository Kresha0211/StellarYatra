@* @model IEnumerable<AstroSafar.Models.UnitAdmin>

<h2 class="mb-4 text-center">🚀 Explore Units</h2>

<div class="accordion" id="unitAccordion">
    @foreach (var unit in Model)
    {
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading-@unit.Id">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@unit.Id" aria-expanded="false" aria-controls="collapse-@unit.Id">
                    <strong>@unit.Name</strong>
                </button>
            </h2>

            <div id="collapse-@unit.Id" class="accordion-collapse collapse" aria-labelledby="heading-@unit.Id" data-bs-parent="#unitAccordion">
                <div class="accordion-body">
                    <p class="unit-content">@unit.Content</p>

                    @if (!string.IsNullOrEmpty(unit.ImageURL))
                    {
                        <img src="@Url.Content(unit.ImageURL)" alt="Unit Image" class="unit-image img-fluid" />
                    }

                    @if (!string.IsNullOrEmpty(unit.VideoUrl))
                    {
                        <div class="video-container">
                            <a href="@unit.VideoUrl" target="_blank" class="btn btn-primary">🎥 Watch Video</a>
                        </div>
                    }

                    <!-- Radio Button for Mark as Completed -->
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="radio" name="completeUnit-@unit.Id" id="completeUnit-@unit.Id" onclick="markUnitCompleted(@unit.Id)">
                        <label class="form-check-label" for="completeUnit-@unit.Id">✅ Mark as Completed</label>
                    </div>

                    <p id="progress-@unit.Id" class="text-primary mt-2"></p>
                </div>
            </div>
        </div>
    }
</div>

<button id="finalExamButton" class="btn btn-danger mt-4" disabled>📜 Take Final Exam</button>

<style>
    .unit-content {
        text-align: justify;
        line-height: 1.8;
        font-size: 1.1rem;
        padding: 15px;
        border-radius: 8px;
        background: #f8f9fa;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    }

    .unit-image {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 15px 0;
    }

    .video-container {
        margin-top: 15px;
    }

    .accordion-button {
        font-size: 1.2rem;
        font-weight: bold;
    }

    .accordion-body {
        background: #ffffff;
        padding: 20px;
        border-radius: 8px;
    }

    .accordion-item {
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
    }
</style>

<script>
    function markUnitCompleted(unitId) {
        fetch(/Client/CompleteUnit?unitId=${unitId}, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById(progress-${unitId}).innerText = Progress: ${data.progress}%;
                    if (data.progress >= 80) {
                        document.getElementById('finalExamButton').disabled = false;
                    }
                }
            })
            .catch(error => console.error('Error:', error));
    }
</script> *@


@*

@model IEnumerable<AstroSafar.Models.UnitAdmin>

<h2 class="mb-4">🚀 Units</h2>
<ul class="list-group">
    @foreach (var unit in Model)
    {
        <li class="list-group-item">
            <h3>@unit.Name</h3>

            @if (!string.IsNullOrEmpty(unit.ImageURL))
            {
                <img src="@unit.ImageURL" alt="Unit Image" class="unit-image" />
            }

            <p>@unit.Content</p>
            <a href="@unit.VideoUrl" target="_blank">Watch Video</a>

        </li>
    }
</ul>

<style>
    .unit-image {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin-top: 10px;
        display: block;
    }

    .video-container {
        margin-top: 15px;
    }
</style>


 *@




@model IEnumerable<AstroSafar.Models.UnitAdmin>

<h2 class="mb-4">🚀 Units</h2>

<!-- 🔍 Search Input -->
<input type="text" id="searchInput" class="form-control mb-3" placeholder="Search units..." onkeyup="debounceFilterUnits()" />

<div class="accordion" id="unitAccordion">
    @foreach (var unit in Model)
    {
        var unitId = "unit" + unit.Id;
        <div class="accordion-item unit" data-title="@unit.Name.ToLower() @unit.Content.ToLower()">
            <h2 class="accordion-header" id="heading-@unitId">
                <button class="accordion-button collapsed unit-title" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@unitId" aria-expanded="false" aria-controls="collapse-@unitId">
                    📖 <span class="unit-name">@unit.Name</span>
                </button>
            </h2>
            <div id="collapse-@unitId" class="accordion-collapse collapse" aria-labelledby="heading-@unitId" data-bs-parent="#unitAccordion">
                <div class="accordion-body">
                    @if (!string.IsNullOrEmpty(unit.ImageURL))
                    {
                        <img src="@unit.ImageURL" alt="Unit Image" class="unit-image" />
                    }

                    @if (!string.IsNullOrEmpty(unit.Content))
                    {
                        var paragraphs = unit.Content.Split(new[] { "\n", "\r\n" }, StringSplitOptions.RemoveEmptyEntries);
                        <div class="unit-content">
                            @foreach (var paragraph in paragraphs)
                            {
                                if (!string.IsNullOrWhiteSpace(paragraph))
                                {
                                    <p class="unit-text">@Html.Raw(paragraph.Trim())</p>
                                }
                            }
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(unit.VideoUrl))
                    {
                        <div class="video-container">
                            <a href="@unit.VideoUrl" target="_blank" class="watch-video">📺 Watch Video</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    }
</div>

<style>
    .accordion-button {
        font-size: 18px;
        font-weight: bold;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 10px;
    }

        .accordion-button:hover {
            background-color: #e2e6ea;
        }

    .accordion-body {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 10px;
    }

    .unit-image {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin-top: 10px;
        display: block;
    }

    .unit-content p {
        margin-bottom: 10px;
        line-height: 1.6;
    }

    .video-container {
        margin-top: 15px;
    }

    .watch-video {
        color: #007bff;
        text-decoration: none;
        font-weight: bold;
    }

        .watch-video:hover {
            text-decoration: underline;
        }

    /* 🔹 Highlight Matching Text */
    .highlight {
        background-color: yellow;
        font-weight: bold;
    }
</style>

<!-- 🔹 JavaScript for Search with Highlighting & Debounce -->
<script>
    let debounceTimer; // Debounce timer variable

    function debounceFilterUnits() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(filterUnits, 300); // Wait 300ms before executing
    }

    function filterUnits() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let units = document.querySelectorAll(".unit");

        units.forEach(unit => {
            let unitTitle = unit.getAttribute("data-title");
            let titleElement = unit.querySelector(".unit-name");
            let contentElements = unit.querySelectorAll(".unit-text");

            if (unitTitle.includes(input)) {
                unit.style.display = "block"; // Show matching units
                highlightText(titleElement, input);
                contentElements.forEach(content => highlightText(content, input));
            } else {
                unit.style.display = "none"; // Hide non-matching units
            }
        });
    }

    function highlightText(element, keyword) {
        if (!keyword) {
            element.innerHTML = element.textContent; // Reset if no search term
            return;
        }

        let regex = new RegExp(`(${keyword})`, "gi");
        element.innerHTML = element.textContent.replace(regex, '<span class="highlight">$1</span>');
    }
</script>

<!-- Bootstrap JS (Required for Accordion) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>